# EASIUR Python Integration Module
Code by ijbd

## Updates
2/12/2021
> Gathered data for emissions, generator location, and marginal social costs. 

2/15/2021
> Fixed EASIUR processing script. Updated data source descriptions.

2/17/2021
> Worked on `easiur.py` with the goal of getting a csv to pull marginal cost per MWh for any generator in the U.S. I started by getting generator info form EIA860 including nameplate capacity and stack heights. **ASSUMPTION:** Since annual emissions/generation data are by plant, each generator in a plant has the same marginal emissions. **ASSUMPTION:** Every generator in a plant has the average height of all stacks reported for that plant. **ASSUMPTION:** Generators with no stack height data are assumed to have stack heights of 150m.

2/18/2021-2/22/2021
> Finished processing the final CSV with marginal health costs ($/MWh) for each plant. 

2/23/2021-3/1/2021
> Found a large numbers of plants without emissions data. Switched to eGRID emissions data, which has a larger number of plants, but found the same issue. **Solution:** Filtered out renewable plants. After applying that filter, the script produced valid marginal health costs for 2881 of 3372 conventional (fossil fuel) plants. 

3/11/2021-3/12/2021
> Some basic updates to maintain consistency with coal plants modular. Return pandas DataFrame and accept pandas Series of plant codes (numpy array still accepted).

## Interface

This module is used for processing and accessing marginal health costs ($/MWh) for power plants across the United States. Running `easiur.py` will generate the `marginalHealthCosts.csv` which holds the desired plant-level marginal health cost data. **This has already been done for you.** The public interface of this module should consist of only the `getMarginalHealthCosts` function. 

`getMarginalHealthCosts` will return health damages per conventional generation ($/MWh) for given ORIS plant codes. The input should be a numpy array with valid plant codes for coal, natural-gas, or petroleum generators. This function returns a pandas dataframe indexed by the plant code with marginal health costs. Invalid plant codes, or plant codes for which data is missing, are returned with `np.nan` values in the dataframe. 

### Example:

    from easiur import getMarginalHealthCosts
    import numpy as np 

    # input variables
    season = 'Annual'
    plantCodes = np.array([7,8,9,10])

    # correct usage
    marginalHealthCosts = getMarginalHealthCosts(plantCodes, season=season, asarray=true)

    # output
    print(marginalHealthCosts)

    
**Note:** `season` can be any of `Annual`, `Spring`, `Summer`, `Fall`, or `Winter`; but it defaults to 'Annual'


## Data Sources

**Sample data is already processed in `marginalHealthCosts.csv`**, but the descriptions of each dataset, and the steps taken to get them, are outlined below.

### EASIUR:
>"The Estimating Air pollution Social Impact Using Regression (EASIUR) model is an easy-to-use tool estimating the social cost (or public health cost) of emissions in the United States. The EASIUR model was derived using regression on a large dataset created by CAMx, a state-of-the-art chemical transport model. The EASIUR closely reproduce the social costs of emissions predicted by full CAMx simulations but without the high computational costs." 

The marginal social costs provided by EASIUR are functions of population age, income, and the USD value. The data provided is for 2020 population and income, in 2010 USD. An inflation rate of 1.2 is used to estimate these costs in 2020 USD (applied in `easiur.py`, after processing)

To get EASIUR Data:
1. Run `getEasiurLocs.py` from the `data/easiur_msc` directory. This script will pull the locations of every power plant in the United States and compile them in a CSV file. It does not include generators with no latitude/longitude locations, and it fixes a latitude typo for plant #62242 in New York. This file is used in conjuction with the EASIUR Online Data Access Tool.
2. Go to the [EASIUR Online Tool](https://barney.ce.cmu.edu/~jinhyok/easiur/online/) [1,2], and use the batch conversion tool by uploading the file generated by `getEasiurLocs.py`. Each line of the output file contains a location and the corresponding Marginal Social Cost of 4 pollutants
3. Move the output file back to `data/easiur_msc`, then run the `processEasiur.py`.

### eGRID Annual Emissions
This [dataset](https://www.epa.gov/egrid/download-data) [3] provides *annual* plant-level generation and emissions (CO2, NOx, and SO2). 

### EIA-860 
>"The survey Form EIA-860 collects generator-level specific information about existing and planned generators and associated environmental equipment at electric power plants with 1 megawatt or greater of combined nameplate capacity. Summary level data can be found in the Electric Power Annual."

Available [here](https://www.eia.gov/electricity/data/eia860/) [4].

## Citations

[1] Jinhyok Heo, Peter J. Adams, H. Gao. (2016) "Reduced-form modeling of public health impacts of inorganic PM2.5 and precursor emissions", Atmospheric Environment, 137, 80—89,. doi:10.1016/j.atmosenv.2016.04.026

[2] Jinhyok Heo, Peter J. Adams, H. Gao. (2016) "Public Health Costs of Primary PM2.5 and Inorganic PM2.5 Precursor Emissions in the United States", Environmental Science & Technology, 50 (11), 6061—6070. doi:10.1021/acs.est.5b06125

[3] Environmental Protection Agency (2019) "Emissions and Generation Resource Integrated Database" 

[4]  Energy Information Administration, Form EIA-930 User Guide Known Issues (2020).550
